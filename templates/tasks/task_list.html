{% extends 'base.html' %}
{% load crispy_forms_filters %}

{% block content %}
  <h1>Task list</h1>
  <div class="row align-left">
    <div class="col-auto">
      <div
          class="card mb-4
                 task-item-container
                 task-form-container
                 {{ task_form.is_bound|yesno:"border-danger," }}"
      >
        <form class="card-body" action="" method="POST" novalidate>
          {% csrf_token %}
          {{ task_form|crispy }}
          <input
              class="btn btn-primary"
              type="submit"
              name="task_form"
              value="Add"
          >
        </form>
      </div>
    </div>
    {% for task in task_list %}
      <div class="col-auto">
        <div class="card mb-4 task-item-container">
          <div class="card-body">
            <div class="row">
              <div class="col-10">
                <h5 class="card-title"
                    style="height: 5rem">
                  {{ task.name | truncatechars:60 }}
                </h5>
              </div>
              <div class="col-2">
                <form class="is_completed_form" action="" method="POST">
                  {% csrf_token %}
                  {{ task.is_completed_form|crispy }}
                  <input type="hidden" name="is_completed_form">
                </form>
              </div>
            </div>

            <p
                class="card-subtitle mb-2"
                style="height: 1rem">
              {% if task.deadline %}
                {{ task.deadline }}
              {% endif %}
            </p>
            <p class="card-text"
               style="height: 5rem;">
              {{ task.description | truncatechars:80 }}
            </p>
            <a href="#" class="card-link">Edit</a>
            <a href="#" class="card-link">Delete</a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}
{% block scripts %}
  <script>
      for (const isCompletedForm of document.getElementsByClassName("is_completed_form")) {
          isCompletedForm
              .getElementsByTagName("input")["is_completed"]
              .addEventListener("change", () => {
                  isCompletedForm.submit()
              })
      }
  </script>
{% endblock %}
